{% extends "layout.html" %}
{% block title %}Admin{% endblock %}
{% block content %}
<div class="item">
  <div class="banner" id="admin-header">
    <h1>Table Assignments</h1>
  </div>
</div>

<style>
.search {
  margin: 0 auto;
  max-width: 400px;
}
.search label {
  font-size: 12px;
  color: #CCCCCC;
  opacity: 0;
}
.input-group {
  display: flex;
  border-bottom: 1px solid #CCCCCC;
  padding: 1px 0;
  margin-bottom: 1px;
}
.input-group svg {
  width: 24px;
  height: 24px;
  fill: white;
}
.input-group input {
  margin: 0;
  height: 24px;
  background-color: transparent;
  color: white;
  border: none;
  outline: none;
}
.search[text] label {
  opacity: 1;
}
.search[focus] label {
  color: #90cfaa;
}
.search[focus] .input-group {
  border-bottom: 2px solid #90cfaa;
  margin-bottom: 0px;
}
</style>

<div class="item search">
  <label for="search">Search</label>
  <div class="input-group">
  <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon"><g class="style-scope iron-icon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" class="style-scope iron-icon"></path></g></svg>
  <input type="text" id="search" placeholder="Search">
  </div>
</div>

<div class="item">
  <div class="info">
    <table id="items">
      <thead>
        <tr>
          <th data-sort-method="caseInsensitiveSort">Name</th>
          <th data-sort-method="caseInsensitiveSort">Location</th>
          <th data-sort-method="caseInsensitiveSort">Description</th>
          <th data-sort-method="caseInsensitiveSort">Prizes</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr class="{{ 'disabled' if not item.active else 'prioritized' if item.prioritized else '' }}">
          <td>{{ item.name | safe }}</td>
          <td>{{ item.location | safe }}</td>
          <td class="preserve-formatting">{{ item.description | safe }}</td>
          <td>{{ item.prizes | safe }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
{% block end %}
<script src="{{ url_for('static', filename='js/vendor/tablesort.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/vendor/tablesort.number.js') }}"></script>
<script src="{{ url_for('static', filename='js/vendor/lunr.min.js') }}"></script>
<script>
const table = document.getElementById('items');
const sort = new Tablesort(table);

const searchContainer = document.querySelector(".search");
const search = document.querySelector("#search");
search.addEventListener("focus", () => {
  searchContainer.setAttribute("focus", true);
});
search.addEventListener("blur", () => {
  searchContainer.removeAttribute("focus");
});

const index = lunr(function () {
  this.field('name');
  this.field('location');
  this.field('description');
  this.field('prizes');
  this.ref('index');
});

const rows = Array.from(table.querySelectorAll("tbody tr"));
rows.forEach((row, i) => {
  const children = row.children;
  const item = {
    index: i,
    name: children[0].innerText,
    location: children[1].innerText,
    description: children[2].innerText,
    prizes: children[3].innerText,
  };
  index.add(item);
});

search.addEventListener("input", () => {
  const val = search.value;
  if (val.length > 0) {
    searchContainer.setAttribute("text", true);
  } else {
    searchContainer.removeAttribute("text");
  }
  const matches = index.search(val);

  const matchesMap = {};
  for (let match of matches) {
    matchesMap[match.ref] = true;
  }

  rows.forEach((row, i) => {
    if (matchesMap[i] || val.length === 0) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  });
});

</script>
{% endblock %}
